
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive NLP Demonstration Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* Global Reset & Base Styling */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --accent-color: #28a745;
            --background-light: #f8f9fa;
            --background-dark: #e9ecef;
            --text-dark: #343a40;
            --text-light: #f8f9fa;
            --border-color: #dee2e6;
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
            display: flex; /* Add flexbox to the body */
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Roboto', sans-serif;
            color: var(--text-dark);
            margin-bottom: 15px;
            font-weight: 600;
        }

        /* Utility classes */
        .hidden {
            display: none !important; /* Ensure it overrides other display properties */
        }

        /* Layout: Sidebar and Main Content */
        .sidebar {
            width: 280px; /* Fixed width sidebar */
            background-color: #2c3e50; /* Darker background for sidebar */
            color: var(--text-light);
            padding: 25px 20px;
            box-shadow: 2px 0 10px var(--shadow-medium);
            display: flex;
            flex-direction: column;
            
            position: fixed; /* Make the sidebar fixed */
            top: 0;
            left: 0;
            height: 100vh; /* Full viewport height */
            overflow-y: auto; /* Enable scrolling for sidebar content if needed */
            z-index: 1001; /* Increased z-index to ensure it's on top */
        }

        .sidebar h2 {
            color: #fff;
            margin-bottom: 30px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 15px;
            width: 100%;
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
            width: 100%;
        }

        .sidebar nav ul li {
            margin-bottom: 8px; /* Slightly less margin */
        }

        .sidebar nav ul li a {
            display: flex; /* For icon and text alignment */
            align-items: center;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 12px 15px;
            border-radius: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-weight: 500;
            font-size: 1.05em; /* Slightly larger text */
        }

        .sidebar nav ul li a i {
            margin-right: 10px;
            font-size: 1.2em; /* Icon size */
        }

        .sidebar nav ul li a:hover,
        .sidebar nav ul li a.active {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        .main-content {
            flex-grow: 1;
            padding: 30px;
            box-sizing: border-box;
            /* Explicitly set margin-left for desktop view */
            margin-left: 280px; 
            overflow-y: auto; /* Enable scrolling for content if needed */
        }

        /* Section Styling for Dynamic Content */
        .content-section {
            background-color: #ffffff;
            padding: 30px;
            margin-bottom: 30px; /* Adjust if needed */
            border-radius: 12px;
            box-shadow: 0 5px 15px var(--shadow-medium);
            border: 1px solid var(--border-color);
        }

        .content-section h2 {
            color: var(--primary-color);
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        /* Card Styling for Features Section */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .card {
            background-color: var(--background-dark);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-light);
            border: 1px solid #dcdcdc;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }

        .card h3 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.4em;
        }

        .card p {
            font-size: 0.95em;
            color: #555;
        }

        /* Input & Button Styling */
        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        textarea, input[type="text"] {
            width: calc(100% - 22px);
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            resize: vertical;
            min-height: 50px; /* Default min-height for all textareas */
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        
        textarea#inputTextDashboard,
        textarea#contextInput {
            min-height: 150px; /* Larger for main text areas */
        }
        textarea#chatInput {
            min-height: 40px;
            max-height: 80px;
            overflow-y: auto;
        }

        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        button {
            padding: 12px 25px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 10px;
            font-weight: 500;
        }

        button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .button-group button {
            width: auto;
            flex-grow: 1;
        }

        /* Result Display Styling */
        .result-output {
            background-color: var(--background-dark);
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--primary-color);
            margin-top: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap; /* Preserve whitespace and wrap lines */
            word-break: break-word; /* Break long words */
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #444;
            font-size: 0.95em;
        }
        .result-output:empty:before {
            content: "Results will appear here after analysis.";
            color: #888;
        }

        /* Specific styles for chat history */
        #chatHistory {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .chat-message {
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .chat-message.user {
            background-color: var(--primary-color);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .chat-message.bot {
            background-color: #e2e6ea;
            color: var(--text-dark);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        /* Options for Length/Number of Topics */
        .options-group {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            align-items: center;
        }
        .options-group div {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .options-group input[type="range"],
        .options[type="number"] {
            width: 100px; /* Fixed width for sliders/numbers */
            padding: 5px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) { /* Adjust breakpoint for smaller screens */
            body {
                flex-direction: column; /* Stack sidebar and main content vertically */
            }
            .sidebar {
                width: 100%;
                height: auto; /* Allow sidebar to collapse height */
                position: relative; /* Make it flow with content on small screens */
                padding: 15px 10px;
                box-shadow: 0 2px 10px var(--shadow-medium);
                flex-direction: row; /* Make sidebar horizontal */
                justify-content: center;
                overflow-x: auto; /* Allow horizontal scroll for many nav items */
                white-space: nowrap; /* Prevent wrapping of nav items */
                z-index: 999; /* Lower z-index when it's not fixed */
            }
            .sidebar h2 {
                display: none; /* Hide title on smaller screens */
            }
            .sidebar nav ul {
                display: flex;
                flex-wrap: nowrap; /* Keep items in a single row */
                justify-content: center;
                gap: 5px;
            }
            .sidebar nav ul li {
                margin-bottom: 0;
                flex-shrink: 0; /* Prevent items from shrinking */
            }
            .sidebar nav ul li a {
                padding: 8px 12px;
                font-size: 0.85em;
            }
            .sidebar nav ul li a i {
                margin-right: 5px;
                font-size: 1em;
            }
            .main-content {
                margin-left: 0; /* Remove margin when sidebar is on top */
                padding: 20px;
            }
            .card-grid {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 15px;
            }
            .content-section {
                padding: 25px;
            }
            button {
                width: 100%;
                margin-top: 15px;
            }
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            .main-content {
                padding: 15px;
            }
            .content-section {
                padding: 20px;
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.4em;
            }
            textarea, input[type="text"] {
                width: calc(100% - 16px); /* Adjust padding */
            }
            .options-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .options-group input[type="range"],
            .options-group input[type="number"] {
                width: calc(100% - 16px);
            }
            .chat-message {
                max-width: 95%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <aside class="sidebar">
        <h2>🤖 Comprehensive NLP Platform</h2>
        <nav>
            <ul>
                <li><a href="#" class="nav-link active" data-target-section="home-section"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="#" class="nav-link" data-target-section="chatbot-section"><i class="fas fa-comments"></i> Conversational Chatbot</a></li>
                <li><a href="#" class="nav-link" data-target-section="sentiment-section"><i class="fas fa-smile"></i> Sentiment Analysis</a></li>
                <li><a href="#" class="nav-link" data-target-section="ner-section"><i class="fas fa-tags"></i> Named Entity Recognition</a></li>
                <li><a href="#" class="nav-link" data-target-section="text-gen-section"><i class="fas fa-pen-fancy"></i> Text Generation</a></li>
                <li><a href="#" class="nav-link" data-target-section="qa-section"><i class="fas fa-question-circle"></i> Question Answering</a></li>
                <li><a href="#" class="nav-link" data-target-section="pos-section"><i class="fas fa-spell-check"></i> Tokenization & POS</a></li>
                <li><a href="#" class="nav-link" data-target-section="summary-section"><i class="fas fa-file-alt"></i> Text Summarization</a></li>
                <li><a href="#" class="nav-link" data-target-section="topic-section"><i class="fas fa-chart-pie"></i> Topic Modeling</a></li>
                <li><a href="#" class="nav-link" data-target-section="dashboard-section"><i class="fas fa-chart-line"></i> Analysis Dashboard</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <section id="home-section" class="content-section">
            <h1>Welcome to the NLP Demonstration Platform</h1>
            <p>This platform showcases various Natural Language Processing capabilities using state-of-the-art models and techniques.</p>
            
            <h2>🚀 Available Features:</h2>
            <h3>Core NLP Tasks:</h3>
            <div class="card-grid">
                <div class="card">
                    <h3>💬 Conversational Chatbot</h3>
                    <p>Interactive AI assistant</p>
                </div>
                <div class="card">
                    <h3>😊 Sentiment Analysis</h3>
                    <p>Detect emotions in text</p>
                </div>
                <div class="card">
                    <h3>🏷️ Named Entity Recognition</h3>
                    <p>Extract entities from text</p>
                </div>
                <div class="card">
                    <h3>✍️ Text Generation</h3>
                    <p>Create new text content</p>
                </div>
                <div class="card">
                    <h3>❓ Question Answering</h3>
                    <p>Get answers from context</p>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Advanced Analysis:</h3>
            <div class="card-grid">
                <div class="card">
                    <h3>🔤 Tokenization & POS Tagging</h3>
                    <p>Break down text structure</p>
                </div>
                <div class="card">
                    <h3>📝 Text Summarization</h3>
                    <p>Generate concise summaries</p>
                </div>
                <div class="card">
                    <h3>📊 Topic Modeling</h3>
                    <p>Discover themes in text</p>
                </div>
                <div class="card">
                    <h3>🔍 Text Analysis Dashboard</h3>
                    <p>Comprehensive text insights</p>
                </div>
            </div>

            <h2 style="margin-top: 30px;">🛠️ Technologies Used:</h2>
            <ul>
                <li><strong>Compromise.js:</strong> Natural language processing (Simplified implementation for demo)</li>
                <li><strong>Plotly.js:</strong> Interactive visualizations (Placeholder for future integration, not currently active in simple demo)</li>
                <li><strong>JavaScript:</strong> Client-side processing</li>
                <li><strong>HTML5 & CSS3:</strong> Modern web interface</li>
            </ul>
            <p style="margin-top: 30px; font-weight: bold; color: var(--primary-color);">👈 Use the sidebar to navigate between different NLP features and start exploring!</p>
        </section>

        <section id="chatbot-section" class="content-section hidden">
            <h2>💬 Conversational Chatbot</h2>
            <p>Chat with an AI assistant that integrates multiple NLP capabilities.</p>

            <div id="chatHistory">
                <div class="chat-message bot">Hello! I'm an AI assistant with NLP capabilities. How can I help you today?</div>
            </div>

            <div class="input-group" style="display: flex; gap: 10px;">
                <textarea id="chatInput" placeholder="Type your message here..."></textarea>
                <button onclick="sendChatMessage()" style="width: 120px; flex-shrink: 0;">Send</button>
            </div>
            <button onclick="clearChatHistory()" class="button-group" style="background-color: var(--secondary-color);">🗑️ Clear Chat History</button>
        </section>

        <section id="sentiment-section" class="content-section hidden">
            <h2>😊 Sentiment Analysis</h2>
            <p>Determine the emotional tone of your text (Positive, Negative, Neutral).</p>

            <div class="input-group">
                <label for="sentimentTextInput">Enter text for sentiment analysis:</label>
                <textarea id="sentimentTextInput" placeholder="Type or paste text here..."></textarea>
            </div>
            <button onclick="runSentimentAnalysis()">Analyze Sentiment</button>
            <div class="result-output" id="sentimentOutput"></div>
        </section>

        <section id="ner-section" class="content-section hidden">
            <h2>🏷️ Named Entity Recognition</h2>
            <p>Identify and classify key entities in text, such as persons, organizations, locations, dates, and monetary values.</p>

            <div class="input-group">
                <label for="nerTextInput">Enter text for entity recognition:</label>
                <textarea id="nerTextInput" placeholder="Type or paste text here..."></textarea>
            </div>
            <button onclick="runNERAnalysis()">Extract Entities</button>
            <div class="result-output" id="nerOutput"></div>
        </section>

        <section id="text-gen-section" class="content-section hidden">
            <h2>✍️ Text Generation</h2>
            <p>Generate creative text content based on your prompts.</p>

            <div class="input-group">
                <label for="genPromptInput">Enter your prompt:</label>
                <textarea id="genPromptInput" placeholder="Start writing something..."></textarea>
            </div>
            
            <div class="options-group">
                <div>
                    <label for="genMaxLength">Max Length:</label>
                    <input type="number" id="genMaxLength" value="200" min="50" max="500" step="50">
                </div>
                <div>
                    <label for="genCreativity">Creativity:</label>
                    <input type="range" id="genCreativity" value="1.0" min="0.1" max="2.0" step="0.1" oninput="document.getElementById('genCreativityValue').innerText=this.value">
                    <span id="genCreativityValue">1.0</span>
                </div>
            </div>

            <button onclick="runTextGeneration()">🚀 Generate Text</button>
            <div class="result-output" id="generatedTextOutput"></div>
        </section>

        <section id="qa-section" class="content-section hidden">
            <h2>❓ Question Answering</h2>
            <p>Ask questions about a given context and get AI-powered answers.</p>

            <div class="input-group">
                <label for="contextInput">Provide context (text to search for answers):</label>
                <textarea id="contextInput" placeholder="Paste a paragraph or article here..."></textarea>
            </div>
            <div class="input-group">
                <label for="questionInput">Ask a question about the context:</label>
                <textarea id="questionInput" placeholder="What would you like to know?"></textarea>
            </div>
            <button onclick="runQuestionAnswering()">🔍 Find Answer</button>
            <div class="result-output" id="answerOutput"></div>
        </section>

        <section id="pos-section" class="content-section hidden">
            <h2>🔤 Tokenization & POS Tagging</h2>
            <p>Analyze the grammatical structure and parts of speech in your text.</p>

            <div class="input-group">
                <label for="posTextInput">Type or paste your text here:</label>
                <textarea id="posTextInput" placeholder="Enter text to analyze its structure..."></textarea>
            </div>
            <button onclick="runPOSTagging()">Analyze Structure</button>
            <div class="result-output" id="posOutput"></div>
        </section>

        <section id="summary-section" class="content-section hidden">
            <h2>📝 Text Summarization</h2>
            <p>Generate concise summaries of longer texts.</p>

            <div class="input-group">
                <label for="summaryTextInput">Enter the text you want to summarize:</label>
                <textarea id="summaryTextInput" placeholder="Paste a long article or document here..."></textarea>
            </div>
            
            <div class="options-group">
                <div>
                    <label for="summaryLength">Summary Length:</label>
                    <select id="summaryLength">
                        <option value="0.1">Very Short (10%)</option>
                        <option value="0.3" selected>Medium (30%)</option>
                        <option value="0.5">Longer (50%)</option>
                    </select>
                </div>
                <div>
                    <label for="summaryType">Summary Type:</label>
                    <select id="summaryType">
                        <option value="extractive">Extractive</option>
                        </select>
                </div>
            </div>

            <button onclick="runTextSummarization()">📄 Generate Summary</button>
            <div class="result-output" id="summaryOutput"></div>
        </section>

        <section id="topic-section" class="content-section hidden">
            <h2>📊 Topic Modeling</h2>
            <p>Discover hidden themes and topics in your text.</p>

            <div class="input-group">
                <label for="topicTextInput">Enter a longer text for topic analysis:</label>
                <textarea id="topicTextInput" placeholder="Provide a substantial amount of text for best results..."></textarea>
            </div>
            
            <div class="options-group">
                <div>
                    <label for="numTopics">Number of Topics:</label>
                    <input type="number" id="numTopics" value="3" min="1" max="10" step="1">
                </div>
                <div>
                    <label for="topicVisualization">Visualization:</label>
                    <select id="topicVisualization">
                        <option value="both">Both</option>
                        <option value="list">List Only</option>
                    </select>
                </div>
            </div>
            <button onclick="runTopicModeling()">🔍 Extract Topics</button>
            <div class="result-output" id="topicsOutput"></div>
        </section>

        <section id="dashboard-section" class="content-section hidden">
            <h2>🔍 Text Analysis Dashboard</h2>
            <p>Comprehensive analysis combining multiple NLP techniques.</p>

            <div class="input-group">
                <label for="inputTextDashboard">Enter text for comprehensive analysis:</label>
                <textarea id="inputTextDashboard" placeholder="Type or paste text for a full NLP breakdown..."></textarea>
            </div>
            <button onclick="runFullAnalysis()">🚀 Analyze Text</button>

            <div class="dashboard-results-summary" style="margin-top: 30px;">
                <h3>Summary of Analysis</h3>
                <div class="card-grid">
                    <div class="card">
                        <h3>Sentiment</h3>
                        <p id="dashboardSentiment"></p>
                    </div>
                    <div class="card">
                        <h3>Key Entities</h3>
                        <p id="dashboardEntities"></p>
                    </div>
                    <div class="card">
                        <h3>Topics</h3>
                        <p id="dashboardTopics"></p>
                    </div>
                </div>
            </div>
            <div class="result-output" id="fullAnalysisOutput" style="margin-top: 20px; font-size: 0.85em; text-align: left;"></div>
        </section>

    </main>

    <script>
        // Global instance of NLPService
        const nlpService = new NLPService();

        class NLPService {
            constructor() {
                this.sentimentWords = {
                    positive: [
                        "good", "great", "excellent", "happy", "love", "awesome", "fantastic",
                        "wonderful", "amazing", "beautiful", "bright", "cheer", "delight",
                        "enthusiasm", "excitement", "freedom", "glorious", "harmony", "joy",
                        "kindness", "laughter", "optimism", "peace", "pleasure", "radiant",
                        "serenity", "success", "thrill", "upbeat", "vibrant", "warmth", "zeal"
                    ],
                    negative: [
                        "bad", "poor", "terrible", "sad", "hate", "awful", "horrible", "ugly",
                        "dark", "gloom", "stress", "fear", "anger", "anxiety", "confusion",
                        "crisis", "disaster", "disappointment", "distress", "failure", "grief",
                        "hardship", "insecurity", "loneliness", "misery", "neglect", "pain",
                        "regret", "sorrow", "tragedy", "unhappy", "worry"
                    ],
                    neutral: [
                        "neutral", "okay", "alright", "indifferent", "plain", "calm", "balanced",
                        "stable", "steady", "normal", "typical", "regular", "ordinary", "simple",
                        "common", "even", "fair", "average"
                    ],
                    question: ["what", "where", "when", "why", "how", "who", "which", "is", "are", "do", "does", "can", "could", "will", "would", "should", "did"]
                };
                this.responseTemplates = {
                    greeting: [
                        "Hello there! How can I assist you today?",
                        "Hi! It's great to hear from you.",
                        "Hey! What can I do for you?",
                        "Greetings! Ready to help."
                    ],
                    positive: [
                        "That's wonderful! Your optimism is contagious.",
                        "Great to see such positive energy in your message!"
                    ],
                    negative: [
                        "I sense some negativity in your message. Is there something I can help with?",
                        "Your message seems to express some concerns. Would you like to talk about it?",
                        "I notice a negative sentiment. I'm here to help if you need support.",
                        "That sounds challenging. How can I assist you?"
                    ],
                    neutral: [
                        "I understand. Let me help you with that.",
                        "That's an interesting point. Tell me more.",
                        "I see what you mean. How can I assist further?",
                        "Thank you for sharing that with me."
                    ],
                    question: [
                        "That's a great question! Based on what you're asking, let me think about that.",
                        "Interesting question! I'd be happy to help you explore that topic.",
                        "Good question! Let me consider what I can tell you about that.",
                        "That's something worth discussing! What specifically interests you about this topic?"
                    ]
                };
            }

            analyzeSentiment(text) {
                if (!text || text.trim().length === 0) { return { polarity: 0, subjectivity: 0, label: 'Neutral' }; }
                const words = text.toLowerCase().match(/\b\w+\b/g) || [];
                let positiveScore = 0;
                let negativeScore = 0;
                let subjectiveWords = 0;
                words.forEach(word => {
                    if (this.sentimentWords.positive.includes(word)) { positiveScore += 1; subjectiveWords += 1; }
                    else if (this.sentimentWords.negative.includes(word)) { negativeScore += 1; subjectiveWords += 1; }
                });
                const totalWords = words.length;
                const netScore = positiveScore - negativeScore;
                const polarity = totalWords > 0 ? netScore / totalWords : 0;
                const subjectivity = totalWords > 0 ? subjectiveWords / totalWords : 0;
                let label = 'Neutral';
                if (polarity > 0.1) label = 'Positive';
                else if (polarity < -0.1) label = 'Negative';
                return {
                    polarity: parseFloat(polarity.toFixed(2)), // Keep it between -1 and 1
                    subjectivity: parseFloat(subjectivity.toFixed(2)), // Keep it between 0 and 1
                    label: label,
                    positiveWords: positiveScore,
                    negativeWords: negativeScore
                };
            }

            extractEntities(text) {
                if (!text || text.trim().length === 0) { return []; }
                const entities = [];
                const personPattern = /\b(?:Mr\.?|Mrs\.?|Ms\.?|Dr\.?|Prof\.?)\s+[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\b/g;
                const persons = text.match(personPattern) || [];
                persons.forEach(person => { entities.push({ text: person.trim(), label: 'PERSON', description: 'Person name' }); });
                const namePattern = /\b[A-Z][a-z]+(?:\s+[A-Z][a-z]+)+\b/g;
                const names = text.match(namePattern) || [];
                names.forEach(name => { if (!persons.some(p => p.includes(name))) { entities.push({ text: name, label: 'PERSON', description: 'Possible person name' }); } });
                const orgPattern = /\b[A-Z][a-z]*(?:\s+[A-Z][a-z]*)*\s+(?:Inc\.?|Corp\.?|LLC|Ltd\.?|Company|Corporation|University|College|School|Hospital|Bank|Group|Foundation|Institute)\b/g;
                const orgs = text.match(orgPattern) || [];
                orgs.forEach(org => { entities.push({ text: org, label: 'ORG', description: 'Organization' }); });
                const datePattern = /\b(?:January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2},?\s+\d{4}\b|\b\d{1,2}\/\d{1,2}\/\d{2,4}\b|\b\d{4}-\d{2}-\d{2}\b/g;
                const dates = text.match(datePattern) || [];
                dates.forEach(date => { entities.push({ text: date, label: 'DATE', description: 'Date' }); });
                const moneyPattern = /\$\d+(?:,\d{3})*(?:\.\d{2})?\b|\b\d+(?:,\d{3})*(?:\.\d{2})?\s+(?:dollars?|USD|euros?|EUR|pounds?|GBP)\b/g;
                const money = text.match(moneyPattern) || [];
                money.forEach(amount => { entities.push({ text: amount, label: 'MONEY', description: 'Monetary amount' }); });
                const locations = [
                    'United States', 'Canada', 'Mexico', 'Brazil', 'Argentina', 'United Kingdom',
                    'France', 'Germany', 'Italy', 'Spain', 'Russia', 'China', 'Japan', 'India',
                    'Australia', 'New York', 'Los Angeles', 'Chicago', 'Houston', 'Phoenix',
                    'Philadelphia', 'San Antonio', 'San Diego', 'Dallas', 'San Jose', 'Austin',
                    'London', 'Paris', 'Berlin', 'Rome', 'Madrid', 'Moscow', 'Tokyo', 'Beijing',
                    'California', 'Texas', 'Florida', 'New York', 'Pennsylvania', 'Illinois',
                    'Madurai', 'Tamil Nadu'
                ];
                locations.forEach(location => {
                    const regex = new RegExp(`\\b${location}\\b`, 'gi');
                    const matches = text.match(regex) || [];
                    matches.forEach(match => { entities.push({ text: match, label: 'GPE', description: 'Geopolitical entity' }); });
                });
                return entities;
            }

            tokenizeAndPOS(text) {
                if (!text || text.trim().length === 0) { return []; }
                const tokens = text.match(/\b\w+\b/g) || [];
                const result = [];
                tokens.forEach(token => {
                    const pos = this.simplePOSTag(token);
                    result.push({ text: token, pos: pos, lemma: token.toLowerCase() });
                });
                return result;
            }

            simplePOSTag(word) {
                const lowerWord = word.toLowerCase();
                if (['the', 'a', 'an', 'this', 'that', 'these', 'those'].includes(lowerWord)) return 'DET';
                if (['i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'us', 'them'].includes(lowerWord)) return 'PRON';
                if (['is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'do', 'does', 'did'].includes(lowerWord)) return 'VERB';
                if (['in', 'on', 'at', 'by', 'for', 'with', 'to', 'from', 'of', 'about'].includes(lowerWord)) return 'ADP';
                if (['and', 'or', 'but', 'so', 'because', 'although', 'if', 'when'].includes(lowerWord)) return 'CONJ';
                if (lowerWord.endsWith('ing')) return 'VERB';
                if (lowerWord.endsWith('ed')) return 'VERB';
                if (lowerWord.endsWith('ly')) return 'ADV';
                if (lowerWord.endsWith('ful') || lowerWord.endsWith('less') || lowerWord.endsWith('ous')) return 'ADJ';
                if (word[0] === word[0].toUpperCase() && word.length > 1) return 'PROPN';
                return 'NOUN';
            }

            generateText(prompt, maxLength = 200, creativity = 1.0) { // Added creativity
                if (!prompt || prompt.trim().length === 0) { return "Please provide a prompt for text generation."; }
                const templates = [
                    "Based on your input, here's a continuation: ",
                    "Expanding on that thought: ",
                    "To elaborate further: ",
                    "This leads to the consideration that: "
                ];
                const words = prompt.toLowerCase().split(' ');
                let continuation = "";
                // Simplified creativity effect: more diverse continuations
                const randomFactor = Math.random() * creativity;

                if (words.some(word => ['story', 'once', 'character', 'plot'].includes(word))) {
                    continuation = this.generateStoryContinuation(randomFactor);
                } else if (words.some(word => ['science', 'research', 'study', 'analysis'].includes(word))) {
                    continuation = this.generateAcademicContinuation(randomFactor);
                } else {
                    continuation = this.generateGeneralContinuation(randomFactor);
                }

                const template = templates[Math.floor(Math.random() * templates.length)];
                const fullText = prompt + " " + template + continuation;
                const wordArray = fullText.split(' ');
                if (wordArray.length > maxLength) { return wordArray.slice(0, maxLength).join(' ') + "..."; }
                return fullText;
            }
            generateStoryContinuation(randomFactor = 1.0) {
                const continuations = [
                    "The story unfolds with unexpected twists and turns, revealing hidden depths in the characters' motivations.",
                    "As the narrative progresses, new challenges emerge that test the protagonist's resolve and determination.",
                    "The plot thickens with each passing moment, drawing readers deeper into the intricate web of relationships and conflicts.",
                    "What follows is a journey of discovery, where each revelation builds upon the last to create a compelling narrative arc."
                ];
                return continuations[Math.floor(Math.random() * continuations.length * randomFactor) % continuations.length];
            }
            generateAcademicContinuation(randomFactor = 1.0) {
                const continuations = [
                    "This research contributes to our understanding of the underlying mechanisms and provides insights for future investigations.",
                    "The findings suggest important implications for both theoretical frameworks and practical applications in the field.",
                    "Further analysis reveals patterns that warrant deeper investigation and systematic study.",
                    "These observations form the foundation for developing more comprehensive models and methodological approaches."
                ];
                return continuations[Math.floor(Math.random() * continuations.length * randomFactor) % continuations.length];
            }
            generateGeneralContinuation(randomFactor = 1.0) {
                const continuations = [
                    "This topic opens up numerous possibilities for exploration and discussion, each offering unique perspectives.",
                    "The implications of this extend far beyond the initial scope, touching on various aspects of modern society.",
                    "Understanding this concept requires examining multiple factors and their interconnected relationships.",
                    "The significance of this cannot be overstated, as it influences many aspects of our daily experiences."
                ];
                return continuations[Math.floor(Math.random() * continuations.length * randomFactor) % continuations.length];
            }

            answerQuestion(question, context) {
                if (!question || !context) { return { answer: null, confidence: 0, context: "Please provide both context and a question." }; }
                const questionWords = question.toLowerCase().split(' ').filter(word => word.length > 2);
                const sentences = context.split(/[.!?]+/).filter(s => s.trim().length > 0);
                let bestSentence = "";
                let bestScore = 0;
                sentences.forEach(sentence => {
                    const sentenceLower = sentence.toLowerCase();
                    let score = 0;
                    questionWords.forEach(word => { if (sentenceLower.includes(word)) { score += 1; } });
                    if (score > bestScore) { bestScore = score; bestSentence = sentence.trim(); }
                });
                const confidence = questionWords.length > 0 ? bestScore / questionWords.length : 0;
                return { answer: bestSentence || "No relevant answer found in the context.", confidence: parseFloat(confidence.toFixed(2)), context: bestSentence };
            }

            summarizeText(text, ratio = 0.3) {
                if (!text || text.trim().length === 0) { return "No text provided for summarization."; }
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
                if (sentences.length <= 2) { return text; }
                const words = text.toLowerCase().match(/\b\w+\b/g) || [];
                const wordFreq = {};
                words.forEach(word => { if (word.length > 3) { wordFreq[word] = (wordFreq[word] || 0) + 1; } });
                const sentenceScores = sentences.map(sentence => {
                    const sentWords = sentence.toLowerCase().match(/\b\w+\b/g) || [];
                    let score = 0;
                    sentWords.forEach(word => { if (wordFreq[word]) { score += wordFreq[word]; } });
                    return { sentence: sentence.trim(), score: score };
                });
                sentenceScores.sort((a, b) => b.score - a.score);
                const numSentences = Math.max(1, Math.floor(sentences.length * ratio));
                const topSentences = sentenceScores.slice(0, numSentences);
                const summary = sentences.filter(sentence => topSentences.some(ts => ts.sentence === sentence.trim()));
                return summary.join('. ') + '.';
            }

            extractTopics(text, numTopics = 3) {
                if (!text || text.trim().length === 0) { return { topics: [], wordFreq: {} }; }
                const words = text.toLowerCase().match(/\b\w+\b/g) || [];
                const stopWords = new Set([
                    'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for',
                    'of', 'with', 'by', 'is', 'are', 'was', 'were', 'be', 'been', 'have',
                    'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should',
                    'i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'its', 'our', 'their', 'this', 'that', 'these', 'those',
                    'am', 'can', 'get', 'just', 'like', 'make', 'not', 'now', 'only', 'out', 'say',
                    'see', 'some', 'than', 'then', 'there', 'these', 'they', 'this', 'time', 'two',
                    'up', 'use', 'very', 'want', 'way', 'well', 'what', 'when', 'where', 'which',
                    'who', 'why', 'will', 'with', 'would', 'your', 'from', 'about', 'into', 'over',
                    'after', 'before', 'above', 'below', 'between', 'through', 'during', 'without',
                    'under', 'around', 'among', 'amongst', 'along', 'across', 'behind', 'below',
                    'beneath', 'beside', 'besides', 'between', 'beyond', 'by', 'down', 'during',
                    'except', 'for', 'from', 'inside', 'into', 'near', 'off', 'on', 'onto', 'out',
                    'outside', 'over', 'past', 'round', 'since', 'than', 'through', 'to', 'toward',
                    'under', 'underneath', 'until', 'up', 'upon', 'with', 'within', 'without', 'etc'
                ]);
                const filteredWords = words.filter(word => word.length > 3 && !stopWords.has(word));
                const wordFreq = {};
                filteredWords.forEach(word => { wordFreq[word] = (wordFreq[word] || 0) + 1; });
                const sortedWords = Object.entries(wordFreq).sort(([,a], [,b]) => b - a);
                const topics = [];
                const wordsPerTopic = Math.max(1, Math.floor(sortedWords.length / numTopics));
                for (let i = 0; i < numTopics && i * wordsPerTopic < sortedWords.length; i++) {
                    const topicWords = sortedWords.slice(i * wordsPerTopic, (i + 1) * wordsPerTopic).slice(0, 5).map(([word]) => word);
                    if (topicWords.length > 0) { topics.push(topicWords); }
                }
                return { topics: topics, wordFreq: Object.fromEntries(sortedWords.slice(0, 20)) };
            }

            generateChatResponse(userInput) {
                const analysis = this.analyzeSentiment(userInput);
                const entities = this.extractEntities(userInput);
                const lowerInput = userInput.toLowerCase();
                if (this.isGreeting(lowerInput)) { return { response: this.getRandomResponse('greeting'), analysis: { sentiment: analysis.label, entities: entities } }; }
                if (this.isQuestion(lowerInput)) { return { response: this.getRandomResponse('question'), analysis: { sentiment: analysis.label, entities: entities } }; }
                let responseType = 'neutral';
                if (analysis.label === 'Positive') responseType = 'positive';
                else if (analysis.label === 'Negative') responseType = 'negative';
                return { response: this.getRandomResponse(responseType), analysis: { sentiment: analysis.label, entities: entities } };
            }

            isGreeting(text) {
                const greetingPatterns = [ 'hello', 'hi', 'hey', 'greetings', 'good morning', 'good afternoon', 'good evening', 'how are you', 'how are things', 'sup' ];
                return greetingPatterns.some(pattern => text.includes(pattern));
            }

            isQuestion(text) {
                const questionWords = ['what', 'how', 'why', 'when', 'where', 'who', 'can you', 'will you', 'is it', 'are you'];
                return questionWords.some(word => text.includes(word)) || text.includes('?');
            }

            getRandomResponse(type) {
                const responses = this.responseTemplates[type] || this.responseTemplates.neutral;
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        // --- UI Logic for Section Switching ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM content loaded."); // Debugging message

            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');

            function showSection(targetId) {
                console.log("Showing section:", targetId); // Debugging message
                contentSections.forEach(section => {
                    if (section.id === targetId) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent default link behavior (page reload)
                    console.log("Nav link clicked for section:", e.target.dataset.targetSection); // Debugging message

                    // Remove 'active' class from all links
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    // Add 'active' class to the clicked link
                    e.currentTarget.classList.add('active'); // Use currentTarget to ensure the 'a' tag is selected

                    // Get the target section ID from the data attribute
                    const targetSectionId = e.currentTarget.dataset.targetSection;
                    showSection(targetSectionId);
                });
            });

            // Show home section by default on load
            showSection('home-section');
        });

        // --- Demo Functions for Each NLP Feature ---

        // Conversational Chatbot
        function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatHistory = document.getElementById('chatHistory');
            const userMessage = chatInput.value.trim();

            if (userMessage) {
                const userMsgDiv = document.createElement('div');
                userMsgDiv.classList.add('chat-message', 'user');
                userMsgDiv.textContent = userMessage;
                chatHistory.appendChild(userMsgDiv);

                chatInput.value = ''; // Clear input

                // Scroll to bottom
                chatHistory.scrollTop = chatHistory.scrollHeight;

                // Get bot response
                setTimeout(() => { // Simulate a small delay for bot response
                    const botResponse = nlpService.generateChatResponse(userMessage);
                    const botMsgDiv = document.createElement('div');
                    botMsgDiv.classList.add('chat-message', 'bot');
                    botMsgDiv.textContent = botResponse.response;
                    chatHistory.appendChild(botMsgDiv);
                    chatHistory.scrollTop = chatHistory.scrollHeight;

                    // Optional: Log analysis to console for debugging
                    console.log('Chat analysis:', botResponse.analysis);
                }, 500);
            }
        }

        function clearChatHistory() {
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML = '<div class="chat-message bot">Hello! I\'m an AI assistant with NLP capabilities. How can I help you today?</div>';
        }

        // Sentiment Analysis
        function runSentimentAnalysis() {
            const text = document.getElementById('sentimentTextInput').value;
            const output = document.getElementById('sentimentOutput');
            if (!text.trim()) {
                output.textContent = "Please enter some text for sentiment analysis.";
                return;
            }
            const result = nlpService.analyzeSentiment(text);
            output.textContent = `Label: ${result.label}\nPolarity: ${result.polarity}\nSubjectivity: ${result.subjectivity}\nPositive Words: ${result.positiveWords}\nNegative Words: ${result.negativeWords}`;
        }

        // Named Entity Recognition
        function runNERAnalysis() {
            const text = document.getElementById('nerTextInput').value;
            const output = document.getElementById('nerOutput');
            if (!text.trim()) {
                output.textContent = "Please enter some text for entity recognition.";
                return;
            }
            const entities = nlpService.extractEntities(text);
            if (entities.length > 0) {
                output.textContent = JSON.stringify(entities, null, 2);
            } else {
                output.textContent = "No named entities found.";
            }
        }

        // Text Generation
        function runTextGeneration() {
            const prompt = document.getElementById('genPromptInput').value;
            const maxLength = parseInt(document.getElementById('genMaxLength').value);
            const creativity = parseFloat(document.getElementById('genCreativity').value);
            const output = document.getElementById('generatedTextOutput');
            if (!prompt.trim()) {
                output.textContent = "Please enter a prompt to generate text.";
                return;
            }
            const generatedText = nlpService.generateText(prompt, maxLength, creativity);
            output.textContent = generatedText;
        }

        // Question Answering
        function runQuestionAnswering() {
            const context = document.getElementById('contextInput').value;
            const question = document.getElementById('questionInput').value;
            const output = document.getElementById('answerOutput');
            if (!context.trim()) {
                output.textContent = "Please provide context text to find an answer.";
                return;
            }
            if (!question.trim()) {
                output.textContent = "Please enter a question.";
                return;
            }
            const result = nlpService.answerQuestion(question, context);
            output.textContent = `Answer: "${result.answer}"\nConfidence: ${(result.confidence * 100).toFixed(2)}%\nContext Sentence: "${result.context}"`;
        }

        // Tokenization & POS Tagging
        function runPOSTagging() {
            const text = document.getElementById('posTextInput').value;
            const output = document.getElementById('posOutput');
            if (!text.trim()) {
                output.textContent = "Please enter some text for tokenization and POS tagging.";
                return;
            }
            const result = nlpService.tokenizeAndPOS(text);
            if (result.length > 0) {
                output.textContent = JSON.stringify(result, null, 2);
            } else {
                output.textContent = "No tokens found.";
            }
        }

        // Text Summarization
        function runTextSummarization() {
            const text = document.getElementById('summaryTextInput').value;
            const ratio = parseFloat(document.getElementById('summaryLength').value);
            const output = document.getElementById('summaryOutput');
            if (!text.trim()) {
                output.textContent = "Please enter text to summarize.";
                return;
            }
            const summary = nlpService.summarizeText(text, ratio);
            output.textContent = summary;
        }

        // Topic Modeling
        function runTopicModeling() {
            const text = document.getElementById('topicTextInput').value;
            const numTopics = parseInt(document.getElementById('numTopics').value);
            const output = document.getElementById('topicsOutput');
            if (!text.trim()) {
                output.textContent = "Please enter text for topic modeling.";
                return;
            }
            const result = nlpService.extractTopics(text, numTopics);
            let outputText = `Extracted Topics (${result.topics.length} groups):\n`;
            if (result.topics.length > 0) {
                result.topics.forEach((topic, index) => {
                    outputText += `  Topic ${index + 1}: ${topic.join(', ')}\n`;
                });
            } else {
                outputText += "No distinct topics found based on current settings.\n";
            }
            outputText += `\nTop 20 Most Frequent Words (excluding stopwords):\n${JSON.stringify(result.wordFreq, null, 2)}`;
            output.textContent = outputText;
        }

        // Full Analysis Dashboard
        function runFullAnalysis() {
            const text = document.getElementById('inputTextDashboard').value;
            const dashboardSentiment = document.getElementById('dashboardSentiment');
            const dashboardEntities = document.getElementById('dashboardEntities');
            const dashboardTopics = document.getElementById('dashboardTopics');
            const fullAnalysisOutput = document.getElementById('fullAnalysisOutput');

            dashboardSentiment.textContent = 'Analyzing...';
            dashboardEntities.textContent = 'Analyzing...';
            dashboardTopics.textContent = 'Analyzing...';
            fullAnalysisOutput.textContent = 'Running all analyses...';

            if (!text.trim()) {
                dashboardSentiment.textContent = 'N/A';
                dashboardEntities.textContent = 'N/A';
                dashboardTopics.textContent = 'N/A';
                fullAnalysisOutput.textContent = "Please enter text for comprehensive analysis.";
                return;
            }

            const sentiment = nlpService.analyzeSentiment(text);
            const entities = nlpService.extractEntities(text);
            const topics = nlpService.extractTopics(text);
            const summary = nlpService.summarizeText(text);
            const pos = nlpService.tokenizeAndPOS(text);

            dashboardSentiment.textContent = `Label: ${sentiment.label} (Polarity: ${sentiment.polarity})`;
            dashboardEntities.textContent = entities.map(e => `${e.text} (${e.label})`).slice(0, 3).join(', ') + (entities.length > 3 ? '...' : '');
            dashboardTopics.textContent = topics.topics.map(t => t.join(', ')).slice(0, 2).join('; ') + (topics.topics.length > 2 ? '...' : '');

            fullAnalysisOutput.textContent = `--- Sentiment Analysis ---\n${JSON.stringify(sentiment, null, 2)}\n\n` +
                                             `--- Named Entities ---\n${JSON.stringify(entities, null, 2)}\n\n` +
                                             `--- Tokens & POS Tags ---\n${JSON.stringify(pos, null, 2)}\n\n` +
                                             `--- Text Summary ---\n${summary}\n\n` +
                                             `--- Extracted Topics ---\n${JSON.stringify(topics.topics, null, 2)}\n\n` +
                                             `--- Top Words by Frequency ---\n${JSON.stringify(topics.wordFreq, null, 2)}`;
        }
    </script>
</body>
</html>

